+++
date = '2025-12-17T00:00:00+09:00'
draft = false
title = 'フーリエフィルタリングによるフラクタルノイズ生成'
tags = ['フラクタル', '数値シミュレーション', '信号処理', 'Python', 'WebGL']
categories = ['技術', '数学']
+++

## フラクタルノイズ生成アプリ

フーリエフィルタリング法を使用してフラクタルノイズを生成し、1D波形・2D高さマップ・レイマーチング可視化を行うWebアプリケーションを作成しました。

**[アプリを試す →](/my-site/python-apps/fractal-noise/)**

## フラクタルノイズとは

フラクタルノイズは、自然界に見られる複雑な形状やパターンを生成するための重要な手法です。山岳地形、雲、海岸線など、自然界の多くの構造は**自己相似性（スケール不変性）**を持っており、これをコンピュータで再現するために使用されます。

### パワースペクトル密度と1/fノイズ

フラクタルノイズの特徴は、そのパワースペクトル密度が周波数に対して**べき乗則**に従うことです：

$$
P(f) \propto f^{-\beta}
$$

ここで：
- $P(f)$：周波数$f$におけるパワースペクトル密度
- $\beta$：スペクトル指数（周波数特性を決定）

代表的なノイズの種類：

- **白色ノイズ（β=0）**：すべての周波数成分が等しい（完全にランダム）
- **ピンクノイズ（β=1、1/fノイズ）**：自然界で最も一般的なゆらぎ
- **ブラウンノイズ（β=2、1/f²ノイズ）**：ランダムウォーク、ブラウン運動

### ハースト指数との関係

ハースト指数$H$は、信号の滑らかさ・持続性を表すパラメータで、スペクトル指数$\beta$と以下の関係があります：

$$
\beta = 2H + 1 \quad \text{(1次元の場合)}
$$

$$
\beta = 2H + 2 \quad \text{(2次元の場合)}
$$

ハースト指数の意味：
- **H = 0.5**：ランダムウォーク（白色ノイズ）、過去と未来に相関なし
- **H < 0.5**：反持続的、荒い変動が多い
- **H > 0.5**：持続的、滑らかな変動が多い（自然な地形など）

## フーリエフィルタリング法の原理

フーリエフィルタリング法は、以下の手順でフラクタルノイズを生成します：

### 1. 周波数領域での構成

各周波数成分$k$に対して、フーリエ係数$A_k$を以下のように設定：

$$
A_k = \sqrt{P_k} \cdot e^{i\phi_k}
$$

ここで：
- $P_k = |k|^{-\beta}$：目標とするパワースペクトル密度
- $\phi_k$：ランダムな位相（一様分布から生成）

振幅$\sqrt{P_k}$の部分は、期待値としてパワースペクトルを$P_k$にするため$\sqrt{|k|^{-\beta}}$とします。また、各周波数成分を独立なガウス確率変数として生成することで、自然な変動を作り出します。

### 2. エルミート対称性の保証

実数値信号を得るため、フーリエ係数は以下のエルミート対称性を満たす必要があります：

$$
A_{-k} = A_k^*
$$

これにより、逆フーリエ変換の結果が実数となります。

### 3. 逆フーリエ変換

構成したフーリエ係数配列に対して逆フーリエ変換（IFFT）を適用し、実空間の信号を得ます：

$$
f(x) = \mathcal{F}^{-1}\{A_k\}
$$

## 1次元フラクタルノイズ

1次元の場合、周波数インデックス$k$に対して：

$$
P_k \propto k^{-\beta}, \quad \beta = 2H + 1
$$

生成される信号は、フラクタル的な時系列データとなり、音楽生成、株価変動のモデル化、自然現象のシミュレーションなどに応用できます。

## 2次元フラクタルノイズ

2次元の場合、周波数ベクトル$(u, v)$に対して：

$$
P_{u,v} \propto (u^2 + v^2)^{-\beta/2}, \quad \beta = 2H + 2
$$

生成される高さマップは、自然な地形や雲のテクスチャなど、2次元のフラクタル構造を持ちます。

### 2次元フーリエ係数の配置

2次元IFFTでは、フーリエ係数配列を以下のように配置します：

```
[DC,  正の水平,  負の水平]
[正の垂直,  第1象限,  第2象限]
[負の垂直,  第3象限,  第4象限]
```

エルミート対称性を維持するため：
- 第3象限 = conjugate(flip(第1象限))
- 第4象限 = conjugate(flip(第2象限))
- 負の水平 = conjugate(reverse(正の水平))
- 負の垂直 = conjugate(reverse(正の垂直))

## レイマーチングによる可視化

生成された2次元高さマップは、レイマーチング（Ray Marching）技術を使ってリアルタイムで3D地形として可視化できます。

レイマーチングは、各ピクセルからレイ（光線）を飛ばし、距離関数（SDF）を使って地形との交点を見つける技術です。本アプリでは：

1. 2D高さマップをテクスチャとしてGPUに転送
2. GLSLシェーダーで地形のSDF（Signed Distance Function）を定義
3. カメラから各ピクセル方向にレイを飛ばし、反復的に交点を探索
4. 法線計算によるライティング、高度による色分け、フォグ効果を適用

これにより、リアルタイムで滑らかな3D地形のレンダリングが可能になります。

## アプリケーション

### 1D波形表示
1次元フラクタルノイズの波形をグラフ表示します。ハースト指数を変更することで、ランダムウォーク（H=0.5）から滑らかな信号（H>0.5）、荒い信号（H<0.5）まで生成できます。

### 2D高さマップ（3Dメッシュ）
2次元フラクタルノイズを高さマップとして生成し、アイソメトリック投影でワイヤーフレーム表示します。H値を調整することで、滑らかな丘から荒い山岳地形まで表現できます。

### レイマーチング地形
生成された高さマップをWebGLのレイマーチング技術で3D地形として描画します。高度によって色が変わり（草地・岩・雪）、リアルタイムでカメラが回転します。

## 実装のポイント

### Python（Pyodide）での生成
NumPyの高速なFFT実装を活用し、ブラウザ上でリアルタイムにフラクタルノイズを生成します。Pyodideを使用することで、Pythonの数値計算ライブラリをそのままWebアプリで利用できます。

### WebGLによる高速描画
レイマーチング部分はGLSLシェーダーで実装し、GPUの並列処理能力を活用して高速な3Dレンダリングを実現しています。

## 参考文献

- Peitgen, H.-O., Saupe, D. (Eds.). (1988). *The Science of Fractal Images*. Springer-Verlag.
- Saupe, D. (1988). "Algorithms for Random Fractals". In *The Science of Fractal Images*, pp. 71-136.
- Voss, R. F. (1988). "Fractals in Nature: From Characterization to Simulation". In *The Science of Fractal Images*, pp. 21-70.

## 関連リンク

- [フラクタル音楽生成アプリ](/my-site/posts/fractal-music-app/)：同じフーリエフィルタリング手法を使った音楽生成
- [MFSヘレショウシミュレーション](/my-site/posts/hele-shaw-simulation/)：流体力学におけるフラクタルパターン

---

**技術スタック**: Python, NumPy, Pyodide, TypeScript, React, WebGL, GLSL
