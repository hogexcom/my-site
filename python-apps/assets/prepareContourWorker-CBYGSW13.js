(function(){"use strict";function L(n,r){let t=0;for(let a of n)a!=null&&(a=+a)>=a&&++t;return t}function j(n,r){let t,a;if(r===void 0)for(const o of n)o!=null&&(t===void 0?o>=o&&(t=a=o):(t>o&&(t=o),a<o&&(a=o)));else{let o=-1;for(let l of n)(l=r(l,++o,n))!=null&&(t===void 0?l>=l&&(t=a=l):(t>l&&(t=l),a<l&&(a=l)))}return[t,a]}const T=Math.sqrt(50),$=Math.sqrt(10),X=Math.sqrt(2);function P(n,r,t){const a=(r-n)/Math.max(0,t),o=Math.floor(Math.log10(a)),l=a/Math.pow(10,o),u=l>=T?10:l>=$?5:l>=X?2:1;let f,c,e;return o<0?(e=Math.pow(10,-o)/u,f=Math.round(n*e),c=Math.round(r*e),f/e<n&&++f,c/e>r&&--c,e=-e):(e=Math.pow(10,o)*u,f=Math.round(n/e),c=Math.round(r/e),f*e<n&&++f,c*e>r&&--c),c<f&&.5<=t&&t<2?P(n,r,t*2):[f,c,e]}function Y(n,r,t){if(r=+r,n=+n,t=+t,!(t>0))return[];if(n===r)return[n];const a=r<n,[o,l,u]=a?P(r,n,t):P(n,r,t);if(!(l>=o))return[];const f=l-o+1,c=new Array(f);if(a)if(u<0)for(let e=0;e<f;++e)c[e]=(l-e)/-u;else for(let e=0;e<f;++e)c[e]=(l-e)*u;else if(u<0)for(let e=0;e<f;++e)c[e]=(o+e)/-u;else for(let e=0;e<f;++e)c[e]=(o+e)*u;return c}function G(n,r,t){return r=+r,n=+n,t=+t,P(n,r,t)[2]}function J(n,r,t){let a;for(;;){const o=G(n,r,t);if(o===a||o===0||!isFinite(o))return[n,r];o>0?(n=Math.floor(n/o)*o,r=Math.ceil(r/o)*o):o<0&&(n=Math.ceil(n*o)/o,r=Math.floor(r*o)/o),a=o}}function K(n){return Math.max(1,Math.ceil(Math.log(L(n))/Math.LN2)+1)}var Q=Array.prototype,Z=Q.slice;function _(n,r){return n-r}function H(n){for(var r=0,t=n.length,a=n[t-1][1]*n[0][0]-n[t-1][0]*n[0][1];++r<t;)a+=n[r-1][1]*n[r][0]-n[r-1][0]*n[r][1];return a}var q=n=>()=>n;function W(n,r){for(var t=-1,a=r.length,o;++t<a;)if(o=nn(n,r[t]))return o;return 0}function nn(n,r){for(var t=r[0],a=r[1],o=-1,l=0,u=n.length,f=u-1;l<u;f=l++){var c=n[l],e=c[0],i=c[1],s=n[f],y=s[0],h=s[1];if(en(c,s,r))return 0;i>a!=h>a&&t<(y-e)*(a-i)/(h-i)+e&&(o=-o)}return o}function en(n,r,t){var a;return rn(n,r,t)&&tn(n[a=+(n[0]===r[0])],t[a],r[a])}function rn(n,r,t){return(r[0]-n[0])*(t[1]-n[1])===(t[0]-n[0])*(r[1]-n[1])}function tn(n,r,t){return n<=r&&r<=t||t<=r&&r<=n}function on(){}var p=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function fn(){var n=1,r=1,t=K,a=c;function o(e){var i=t(e);if(Array.isArray(i))i=i.slice().sort(_);else{const s=j(e,an);for(i=Y(...J(s[0],s[1],i),i);i[i.length-1]>=s[1];)i.pop();for(;i[1]<s[0];)i.shift()}return i.map(s=>l(e,s))}function l(e,i){const s=i==null?NaN:+i;if(isNaN(s))throw new Error(`invalid value: ${i}`);var y=[],h=[];return u(e,s,function(d){a(d,e,s),H(d)>0?y.push([d]):h.push(d)}),h.forEach(function(d){for(var g=0,v=y.length,M;g<v;++g)if(W((M=y[g])[0],d)!==-1){M.push(d);return}}),{type:"MultiPolygon",value:i,coordinates:y}}function u(e,i,s){var y=new Array,h=new Array,d,g,v,M,w,A;for(d=g=-1,M=N(e[0],i),p[M<<1].forEach(E);++d<n-1;)v=M,M=N(e[d+1],i),p[v|M<<1].forEach(E);for(p[M<<0].forEach(E);++g<r-1;){for(d=-1,M=N(e[g*n+n],i),w=N(e[g*n],i),p[M<<1|w<<2].forEach(E);++d<n-1;)v=M,M=N(e[g*n+n+d+1],i),A=w,w=N(e[g*n+d+1],i),p[v|M<<1|w<<2|A<<3].forEach(E);p[M|w<<3].forEach(E)}for(d=-1,w=e[g*n]>=i,p[w<<2].forEach(E);++d<n-1;)A=w,w=N(e[g*n+d+1],i),p[w<<2|A<<3].forEach(E);p[w<<3].forEach(E);function E(S){var C=[S[0][0]+d,S[0][1]+g],k=[S[1][0]+d,S[1][1]+g],b=f(C),D=f(k),m,x;(m=h[b])?(x=y[D])?(delete h[m.end],delete y[x.start],m===x?(m.ring.push(k),s(m.ring)):y[m.start]=h[x.end]={start:m.start,end:x.end,ring:m.ring.concat(x.ring)}):(delete h[m.end],m.ring.push(k),h[m.end=D]=m):(m=y[D])?(x=h[b])?(delete y[m.start],delete h[x.end],m===x?(m.ring.push(k),s(m.ring)):y[x.start]=h[m.end]={start:x.start,end:m.end,ring:x.ring.concat(m.ring)}):(delete y[m.start],m.ring.unshift(C),y[m.start=b]=m):y[b]=h[D]={start:b,end:D,ring:[C,k]}}}function f(e){return e[0]*2+e[1]*(n+1)*4}function c(e,i,s){e.forEach(function(y){var h=y[0],d=y[1],g=h|0,v=d|0,M=F(i[v*n+g]);h>0&&h<n&&g===h&&(y[0]=z(h,F(i[v*n+g-1]),M,s)),d>0&&d<r&&v===d&&(y[1]=z(d,F(i[(v-1)*n+g]),M,s))})}return o.contour=l,o.size=function(e){if(!arguments.length)return[n,r];var i=Math.floor(e[0]),s=Math.floor(e[1]);if(!(i>=0&&s>=0))throw new Error("invalid size");return n=i,r=s,o},o.thresholds=function(e){return arguments.length?(t=typeof e=="function"?e:Array.isArray(e)?q(Z.call(e)):q(e),o):t},o.smooth=function(e){return arguments.length?(a=e?c:on,o):a===c},o}function an(n){return isFinite(n)?n:NaN}function N(n,r){return n==null?!1:+n>=r}function F(n){return n==null||isNaN(n=+n)?-1/0:n}function z(n,r,t,a){const o=a-r,l=t-r,u=isFinite(o)||isFinite(l)?o/l:Math.sign(o)/Math.sign(l);return isNaN(u)?n:n+u-.5}function cn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var O={exports:{}},I;function sn(){return I||(I=1,(function(n){(function(){function r(f,c){var e=f.x-c.x,i=f.y-c.y;return e*e+i*i}function t(f,c,e){var i=c.x,s=c.y,y=e.x-i,h=e.y-s;if(y!==0||h!==0){var d=((f.x-i)*y+(f.y-s)*h)/(y*y+h*h);d>1?(i=e.x,s=e.y):d>0&&(i+=y*d,s+=h*d)}return y=f.x-i,h=f.y-s,y*y+h*h}function a(f,c){for(var e=f[0],i=[e],s,y=1,h=f.length;y<h;y++)s=f[y],r(s,e)>c&&(i.push(s),e=s);return e!==s&&i.push(s),i}function o(f,c,e,i,s){for(var y=i,h,d=c+1;d<e;d++){var g=t(f[d],f[c],f[e]);g>y&&(h=d,y=g)}y>i&&(h-c>1&&o(f,c,h,i,s),s.push(f[h]),e-h>1&&o(f,h,e,i,s))}function l(f,c){var e=f.length-1,i=[f[0]];return o(f,0,e,c,i),i.push(f[e]),i}function u(f,c,e){if(f.length<=2)return f;var i=c!==void 0?c*c:1;return f=e?f:a(f,i),f=l(f,i),f}n.exports=u,n.exports.default=u})()})(O)),O.exports}var ln=sn(),un=cn(ln);function hn(n){for(let r=3;r<n.length;r+=4)if(n[r]!==255)return!0;return!1}function yn(n,r,t,a,o,l,u){const f=hn(n),c=new Uint8Array(a*o),e=r/a,i=t/o;for(let s=0;s<o;s++){const y=Math.min(t-1,Math.floor((s+.5)*i));for(let h=0;h<a;h++){const d=Math.min(r-1,Math.floor((h+.5)*e)),g=(y*r+d)*4,v=n[g+0],M=n[g+1],w=n[g+2],A=n[g+3];if(f)c[s*a+h]=A>=l?1:0;else{const E=.299*v+.587*M+.114*w;c[s*a+h]=E<u?1:0}}}return c}function R(n,r,t){const a=new Uint8Array(r*t);for(let o=0;o<t;o++)for(let l=0;l<r;l++){let u=0;for(let f=-1;f<=1&&!u;f++){const c=o+f;if(!(c<0||c>=t))for(let e=-1;e<=1;e++){const i=l+e;if(!(i<0||i>=r)&&n[c*r+i]){u=1;break}}}a[o*r+l]=u}return a}function V(n,r,t){const a=new Uint8Array(r*t);for(let o=0;o<t;o++)for(let l=0;l<r;l++){let u=1;for(let f=-1;f<=1&&u;f++){const c=o+f;if(c<0||c>=t){u=0;break}for(let e=-1;e<=1;e++){const i=l+e;if(i<0||i>=r){u=0;break}if(!n[c*r+i]){u=0;break}}}a[o*r+l]=u}return a}function dn(n,r,t){return V(R(n,r,t),r,t)}function mn(n,r,t){return R(V(n,r,t),r,t)}function U(n){let r=0;const t=n.length;for(let a=0;a<t;a++){const o=(a+1)%t;r+=n[a][0]*n[o][1]-n[o][0]*n[a][1]}return r}function B(n){return U(n)<0?n.slice().reverse():n.slice()}function gn(n){let r=0;const t=n.length;for(let a=0;a<t;a++){const o=(a+1)%t;r+=Math.hypot(n[o][0]-n[a][0],n[o][1]-n[a][1])}return r}function Mn(n,r,t){const a=Math.abs(U(n))/2,o=t-r,l=Math.abs(Math.sin(o));if(l<1e-10)throw new Error("theta1 and theta2 are nearly parallel");const u=Math.sqrt(a/l),f=[u*Math.cos(r),u*Math.sin(r)],c=[u*Math.cos(t),u*Math.sin(t)];return[f,c]}function xn(n,r,t){const a=new Array(r*t);for(let e=0;e<a.length;e++)a[e]=n[e];const l=fn().size([r,t]).thresholds([.5])(a);if(!l.length)throw new Error("輪郭が見つかりません");const u=l[0];if(!u.coordinates||!u.coordinates.length)throw new Error("輪郭が見つかりません");let f=null,c=-1;for(const e of u.coordinates){if(!e.length)continue;const i=e[0];if(i.length<3)continue;const s=i.map(([h,d])=>[h,d]),y=Math.abs(U(s))/2;y>c&&(c=y,f=s)}if(!f)throw new Error("輪郭が見つかりません");if(f.length>=2){const e=f[0],i=f[f.length-1];e[0]===i[0]&&e[1]===i[1]&&(f=f.slice(0,-1))}return f}self.onmessage=n=>{const r=n.data;if(r.type!=="process")return;const{id:t,width:a,height:o,buffer:l,options:u}=r;try{const f=new Uint8ClampedArray(l),c=Math.max(a,o),e=u.maxDimension>0&&c>u.maxDimension?u.maxDimension/c:1,i=Math.max(1,Math.round(a*e)),s=Math.max(1,Math.round(o*e)),y=yn(f,a,o,i,s,u.alphaThreshold,u.grayscaleThreshold),h=mn(dn(y,i,s),i,s),d=xn(h,i,s),g=e===0?1:1/e,v=e===1?d:d.map(([m,x])=>[m*g,x*g]),M=B(v),w=gn(M),A=u.simplifyRatio*w,S=un(M.map(([m,x])=>({x:m,y:x})),A,!0).map(m=>[m.x,m.y]),C=B(S.length>=3?S:M),[k,b]=Mn(C,u.theta1,u.theta2),D={id:t,type:"result",contour:C.map(([m,x])=>[m,x]),tranU:[k[0],k[1]],tranV:[b[0],b[1]]};self.postMessage(D)}catch(f){const c=f instanceof Error?f.message:String(f),e={id:t,type:"error",message:c};self.postMessage(e)}}})();
