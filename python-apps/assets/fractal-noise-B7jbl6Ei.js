import"./modulepreload-polyfill-B5Qt9EMX.js";import{r as h,j as t,c as J}from"./vendor-three-BnpV2lbo.js";import{u as O}from"./usePyodide-BJDiuWYS.js";import"./vendor-react-CCYiWZgt.js";function Y(){const[c,I]=h.useState("1d"),[R,B]=h.useState(.75),[A,M]=h.useState(1024),[E,$]=h.useState(128),[L,F]=h.useState(!1),U=h.useRef(null),G=h.useRef(null),k=h.useRef(null),T=h.useRef(null),S=h.useRef(null),{pyodide:f,isReady:x,error:H}=O(["fractal_noise_1d.py","fractal_noise_2d.py"]),C=h.useCallback(async()=>{if(!(!f||!x||!U.current)){F(!0);try{await f.runPythonAsync(`
import fractal_noise_1d
import numpy as np

f = fractal_noise_1d.generate_fractal_1d(${A}, ${R})
signal_data = f.tolist()
      `);const r=f.globals.get("signal_data").toJs(),e=Array.from(r),l=U.current,s=l.getContext("2d");if(!s)return;l.width=800,l.height=400,s.fillStyle="#1a1a1a",s.fillRect(0,0,l.width,l.height);const p=Math.min(...e),o=Math.max(...e)-p;s.strokeStyle="#00d4ff",s.lineWidth=2,s.beginPath(),e.forEach((a,m)=>{const d=m/e.length*l.width,g=l.height-(a-p)/o*l.height*.8-l.height*.1;m===0?s.moveTo(d,g):s.lineTo(d,g)}),s.stroke(),s.strokeStyle="#333",s.lineWidth=1;for(let a=0;a<=4;a++){const m=a/4*l.height;s.beginPath(),s.moveTo(0,m),s.lineTo(l.width,m),s.stroke()}}catch(r){console.error("1D Generation error:",r)}finally{F(!1)}}},[f,x,R,A]),j=h.useCallback(async(r=!1)=>{if(!f||!x)return!1;F(!0);const e=r?1024:E;try{await f.runPythonAsync(`
import fractal_noise_2d
import numpy as np

heightmap = fractal_noise_2d.generate_fractal_2d(${e}, ${R})
heightmap_normalized = ((heightmap - heightmap.min()) / (heightmap.max() - heightmap.min()) * 255).astype(np.uint8)
heightmap_list = heightmap_normalized.flatten().tolist()
heightmap_3d = heightmap.tolist()
      `);const l=f.globals.get("heightmap_list").toJs(),s=f.globals.get("heightmap_3d").toJs(),p=new Uint8ClampedArray(Array.from(l)),u=new ImageData(e,e);for(let n=0;n<p.length;n++)u.data[n*4]=p[n],u.data[n*4+1]=p[n],u.data[n*4+2]=p[n],u.data[n*4+3]=255;T.current=u;const o=G.current;if(!o)return!0;const a=o.getContext("2d");if(!a)return!0;o.width=800,o.height=600,a.fillStyle="#1a1a1a",a.fillRect(0,0,o.width,o.height);const m=Array.from(s).map(n=>Array.from(n));let d=1/0,g=-1/0;for(let n=0;n<e;n++)for(let i=0;i<e;i++){const y=m[n][i];y<d&&(d=y),y>g&&(g=y)}const w=g-d,_=Math.min(o.width,o.height)/e/1.5,b=w>0?200/w:100,N=-100;console.log(`Height range: ${d.toFixed(3)} to ${g.toFixed(3)}, scale: ${b.toFixed(2)}`);const v=8;a.strokeStyle="#00d4ff",a.lineWidth=.5;for(let n=0;n<e;n+=v){a.beginPath();for(let i=0;i<e;i+=v){const y=(m[n][i]-d)*b,D=o.width/2+(i-n)*_*.866,P=o.height/2+(i+n)*_*.5-y+N;i===0?a.moveTo(D,P):a.lineTo(D,P)}a.stroke()}for(let n=0;n<e;n+=v){a.beginPath();for(let i=0;i<e;i+=v){const y=(m[i][n]-d)*b,D=o.width/2+(n-i)*_*.866,P=o.height/2+(n+i)*_*.5-y+N;i===0?a.moveTo(D,P):a.lineTo(D,P)}a.stroke()}}catch(l){return console.error("2D Generation error:",l),!1}finally{F(!1)}return!0},[f,x,R,E]),X=h.useCallback(async()=>{if(!k.current||!T.current){console.log("Canvas or heightmap not ready");return}try{const r=k.current,e=r.getContext("webgl");if(!e){console.error("WebGL not supported");return}r.width=800,r.height=600;const l=await fetch("/my-site/python-apps/mountain_raycast.glsl");if(!l.ok){console.error("Failed to load shader");return}const s=await l.text(),p=`
      attribute vec2 position;
      void main() {
        gl_Position = vec4(position, 0.0, 1.0);
      }
    `,u=e.createShader(e.VERTEX_SHADER);e.shaderSource(u,p),e.compileShader(u);const o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,s),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){console.error("Fragment shader error:",e.getShaderInfoLog(o));return}const a=e.createProgram();if(e.attachShader(a,u),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){console.error("Program link error:",e.getProgramInfoLog(a));return}e.useProgram(a);const m=new Float32Array([-1,-1,1,-1,-1,1,1,1]),d=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW);const g=e.getAttribLocation(a,"position");e.enableVertexAttribArray(g),e.vertexAttribPointer(g,2,e.FLOAT,!1,0,0);const w=e.createTexture();e.bindTexture(e.TEXTURE_2D,w),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,T.current),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT);const _=e.getUniformLocation(a,"u_resolution"),b=e.getUniformLocation(a,"u_time"),N=e.getUniformLocation(a,"u_heightmap");if(!_||!b||!N){console.error("Failed to get uniform locations");return}e.uniform2f(_,r.width,r.height),e.uniform1i(N,0);let v=Date.now();const n=()=>{const i=(Date.now()-v)/1e3;e.uniform1f(b,i),e.viewport(0,0,r.width,r.height),e.drawArrays(e.TRIANGLE_STRIP,0,4),S.current=requestAnimationFrame(n)};n()}catch(r){console.error("Raymarch setup error:",r)}},[]);h.useEffect(()=>{if(x)return c==="1d"?C():c==="2d"?j():c==="raymarch"&&j(!0).then(r=>{r&&T.current&&setTimeout(()=>X(),100)}).catch(r=>{console.error("Failed to generate 2D data for raymarch:",r)}),()=>{S.current&&cancelAnimationFrame(S.current)}},[c,x]),h.useEffect(()=>{!x||L||(c==="1d"?C():c==="2d"&&j())},[R,A,E]);const W=()=>{S.current&&cancelAnimationFrame(S.current),c==="1d"?C():c==="2d"?j():c==="raymarch"&&(console.log("Starting raymarch generation..."),j(!0).then(r=>{console.log("generate2D completed, success:",r,"heightmapRef:",T.current),r&&T.current?(console.log("Setting up raymarch..."),setTimeout(()=>X(),100)):console.error("Failed to generate heightmap. Success:",r,"HeightmapRef:",T.current)}).catch(r=>{console.error("Raymarch generation error:",r)}))};return t.jsxs("div",{className:"app-container",children:[t.jsxs("header",{className:"app-header",children:[t.jsx("h1",{children:"üåÑ Fractal Noise Generator"}),t.jsx("p",{className:"subtitle",children:"„Éï„Éº„É™„Ç®„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Å´„Çà„Çã„Éï„É©„ÇØ„Çø„É´„Éé„Ç§„Ç∫ÁîüÊàê"})]}),H&&t.jsxs("div",{className:"error-message",children:["Error: ",H]}),t.jsxs("div",{className:"tabs",children:[t.jsx("button",{className:c==="1d"?"tab-button active":"tab-button",onClick:()=>I("1d"),children:"1D Noise"}),t.jsx("button",{className:c==="2d"?"tab-button active":"tab-button",onClick:()=>I("2d"),children:"2D Mesh"}),t.jsx("button",{className:c==="raymarch"?"tab-button active":"tab-button",onClick:()=>I("raymarch"),children:"Raymarch"})]}),t.jsxs("div",{className:"main-content",children:[t.jsx("aside",{className:"sidebar",children:t.jsxs("div",{className:"controls",children:[t.jsxs("div",{className:"controls-grid",children:[t.jsxs("div",{className:"control-group",children:[t.jsxs("label",{children:["Hurst Index (H): ",R.toFixed(2),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:R,onChange:r=>B(parseFloat(r.target.value))})]}),t.jsx("p",{className:"hint",children:"H=0.5: „Éõ„ÉØ„Ç§„Éà„Éé„Ç§„Ç∫, H<0.5: Ëçí„ÅÑ, H>0.5: Êªë„Çâ„Åã"})]}),c==="1d"&&t.jsx("div",{className:"control-group",children:t.jsxs("label",{children:["Resolution: ",A,t.jsx("input",{type:"range",min:"128",max:"4096",step:"128",value:A,onChange:r=>M(parseInt(r.target.value))})]})}),c==="2d"&&t.jsx("div",{className:"control-group",children:t.jsxs("label",{children:["Resolution: ",E,"x",E,t.jsx("input",{type:"range",min:"64",max:"512",step:"32",value:E,onChange:r=>$(parseInt(r.target.value))})]})}),c==="raymarch"&&t.jsx("div",{className:"control-group",children:t.jsx("p",{className:"hint",children:"Resolution: 1024x1024 (Fixed for optimal quality)"})})]}),t.jsx("button",{className:"generate-button",onClick:W,disabled:!x||L,children:L?"ÁîüÊàê‰∏≠...":"ÁîüÊàê"})]})}),t.jsxs("div",{className:"canvas-container",children:[c==="1d"&&t.jsx("canvas",{ref:U,className:"noise-canvas"}),c==="2d"&&t.jsx("canvas",{ref:G,className:"noise-canvas"}),c==="raymarch"&&t.jsx("canvas",{ref:k,className:"noise-canvas"})]})]}),t.jsx("footer",{className:"app-footer",children:t.jsx("p",{children:t.jsx("a",{href:"/my-site/python-apps/",children:"‚Üê Back to Apps"})})})]})}J.createRoot(document.getElementById("root")).render(t.jsx(h.StrictMode,{children:t.jsx(Y,{})}));
