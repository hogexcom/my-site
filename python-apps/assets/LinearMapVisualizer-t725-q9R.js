import{r as l,j as s}from"./vendor-three-DWdYVK8p.js";const d=4,C=3.6,z=14;function O(a,w,T){return Math.min(T,Math.max(w,a))}function f(a){return a.toFixed(2)}function ne({value:a,onChange:w,showReset:T=!0,resetLabel:_="Reset"}){const[c,V]=l.useState(a?.v1??{x:1,y:0}),[i,k]=l.useState(a?.v2??{x:0,y:1}),[u,D]=l.useState(a?.translation??{x:0,y:0}),[Z,L]=l.useState(null),[F,E]=l.useState(!1),[I,W]=l.useState(1),m=l.useRef(null),v=l.useRef(null),G=l.useMemo(()=>c.x*i.y-c.y*i.x,[c,i]);l.useEffect(()=>{a&&(V(a.v1),k(a.v2),D(a.translation))},[a?.v1.x,a?.v1.y,a?.v2.x,a?.v2.y,a?.translation.x,a?.translation.y]);const P=l.useCallback(e=>{const n=e.getBoundingClientRect(),t=Math.min(n.width,n.height)/(d*2+2)*I;return{width:n.width,height:n.height,centerX:n.width/2,centerY:n.height/2,scale:t}},[I]),p=l.useCallback((e,n)=>({x:n.centerX+e.x*n.scale,y:n.centerY-e.y*n.scale}),[]),X=l.useCallback((e,n,t)=>({x:(e-t.centerX)/t.scale,y:(t.centerY-n)/t.scale}),[]),M=l.useCallback(()=>{const e=m.current;if(!e)return;const n=e.getBoundingClientRect(),t=window.devicePixelRatio||1;e.width=Math.round(n.width*t),e.height=Math.round(n.height*t);const r=e.getContext("2d");if(!r)return;r.setTransform(t,0,0,t,0,0);const o=P(e);r.clearRect(0,0,o.width,o.height),r.fillStyle="#0b0f14",r.fillRect(0,0,o.width,o.height);const h=(x,N,b,y=1)=>{const S=p(x,o),H=p(N,o);r.strokeStyle=b,r.lineWidth=y,r.beginPath(),r.moveTo(S.x,S.y),r.lineTo(H.x,H.y),r.stroke()};for(let x=-d;x<=d;x+=1){const N={x:c.x*x+i.x*-d,y:c.y*x+i.y*-d},b={x:c.x*x+i.x*d,y:c.y*x+i.y*d};h(N,b,"#1b2a36");const y={x:c.x*-d+i.x*x,y:c.y*-d+i.y*x},S={x:c.x*d+i.x*x,y:c.y*d+i.y*x};h(y,S,"#1b2a36")}h({x:-d-1,y:0},{x:d+1,y:0},"#2f3944",1.5),h({x:0,y:-d-1},{x:0,y:d+1},"#2f3944",1.5);const j={x:0,y:0};h(j,c,"#ff6b6b",2.5),h(j,i,"#4cc9f0",2.5),h(j,u,"#7ee787",2);const g=(x,N,b)=>{const y=p(x,o);r.fillStyle=N,r.beginPath(),r.arc(y.x,y.y,8,0,Math.PI*2),r.fill(),r.strokeStyle="#0b0f14",r.lineWidth=2,r.beginPath(),r.arc(y.x,y.y,8,0,Math.PI*2),r.stroke(),r.fillStyle="#e6edf3",r.font="12px system-ui, sans-serif",r.fillText(b,y.x+10,y.y-10)};g(c,"#ff6b6b","e1"),g(i,"#4cc9f0","e2"),g(u,"#7ee787","t")},[P,p,u,c,i]);l.useEffect(()=>{M()},[M]),l.useEffect(()=>{const e=()=>M();return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[M]);const R=(e,n,t)=>{w&&w({v1:e,v2:n,translation:t})},Y=(e,n)=>{const t={x:O(n.x,-C,C),y:O(n.y,-C,C)};e==="v1"&&(V(t),R(t,i,u)),e==="v2"&&(k(t),R(c,t,u)),e==="t"&&(D(t),R(c,i,t))},A=e=>{const n=m.current;if(!n)return null;const t=n.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}},B=(e,n)=>{const t=p(c,n),r=p(i,n),o=p(u,n),h=Math.hypot(e.x-t.x,e.y-t.y),j=Math.hypot(e.x-r.x,e.y-r.y),g=Math.hypot(e.x-o.x,e.y-o.y);return h<z?"v1":j<z?"v2":g<z?"t":null},q=e=>{const n=m.current;if(!n)return;const t=A(e);if(!t)return;const r=P(n),o=B(t,r);if(!o){v.current=null,E(!1);return}v.current=o,L(o),E(!0),n.setPointerCapture(e.pointerId);const h=X(t.x,t.y,r);Y(o,h)},J=e=>{const n=m.current;if(!n)return;const t=A(e);if(!t)return;const r=P(n);if(v.current){const h=X(t.x,t.y,r);Y(v.current,h);return}const o=B(t,r);L(o)},U=e=>{!m.current||!v.current||(m.current.releasePointerCapture(e.pointerId),v.current=null,E(!1))},K=()=>{v.current||L(null)},Q=e=>{e.preventDefault();const n=e.deltaY>0?-1:1,t=I*(n>0?1.1:.9);W(Math.max(1,Math.min(3,t)))},$=()=>{const e={x:1,y:0},n={x:0,y:1},t={x:0,y:0};V(e),k(n),D(t),W(1),R(e,n,t)},ee=["map-canvas",Z?"is-hovering":"",F?"is-dragging":""].filter(Boolean).join(" ");return s.jsxs("section",{className:"linear-map",children:[T&&s.jsx("div",{className:"linear-map-toolbar",children:s.jsx("button",{className:"reset-button",onClick:$,children:_})}),s.jsxs("div",{className:"app-layout",children:[s.jsxs("div",{className:"canvas-panel",children:[s.jsx("div",{className:"canvas-frame",children:s.jsx("canvas",{ref:m,className:ee,onPointerDown:q,onPointerMove:J,onPointerUp:U,onPointerLeave:K,onPointerCancel:U,onWheel:Q})}),s.jsx("p",{className:"hint",children:"赤と青のハンドルをドラッグして写像を変更します。"})]}),s.jsxs("aside",{className:"info-panel",children:[s.jsxs("div",{className:"info-card",children:[s.jsx("h2",{children:"行列表記"}),s.jsxs("div",{className:"matrix",children:[s.jsx("div",{className:"bracket",children:"["}),s.jsxs("div",{className:"matrix-body matrix-body-affine",children:[s.jsx("div",{children:f(c.x)}),s.jsx("div",{children:f(i.x)}),s.jsx("div",{children:f(u.x)}),s.jsx("div",{children:f(c.y)}),s.jsx("div",{children:f(i.y)}),s.jsx("div",{children:f(u.y)})]}),s.jsx("div",{className:"bracket",children:"]"})]}),s.jsx("p",{className:"matrix-note",children:"列ベクトル: e1, e2, t"})]}),s.jsxs("div",{className:"info-card",children:[s.jsx("h2",{children:"ベクトルの値"}),s.jsxs("div",{className:"vector-row",children:[s.jsx("span",{className:"chip chip-red",children:"e1"}),s.jsxs("span",{children:["(",f(c.x),", ",f(c.y),")"]})]}),s.jsxs("div",{className:"vector-row",children:[s.jsx("span",{className:"chip chip-blue",children:"e2"}),s.jsxs("span",{children:["(",f(i.x),", ",f(i.y),")"]})]}),s.jsxs("div",{className:"vector-row",children:[s.jsx("span",{className:"chip chip-green",children:"t"}),s.jsxs("span",{children:["(",f(u.x),", ",f(u.y),")"]})]})]}),s.jsxs("div",{className:"info-card",children:[s.jsx("h2",{children:"行列式"}),s.jsxs("p",{className:"determinant",children:["det = ",f(G)]}),s.jsx("p",{className:"matrix-note",children:"正: 向きを保持 / 負: 反転 / 0: つぶれる"})]})]})]})]})}export{ne as L};
